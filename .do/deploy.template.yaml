name: job-crawler
region: nyc
services:
- name: api
  github:
    branch: playgroud
    repo: jgabrielsantosc/scraper-jobboard
  build_command: npm run build:api
  run_command: npm run start:prod
  instance_count: 1
  instance_size_slug: basic-xxs
  envs:
  - key: NODE_ENV
    value: production
  - key: PORT
    value: "3001"
  - key: REDIS_HOST
    value: ${redis.host}
  - key: REDIS_PORT
    value: ${redis.port}
  - key: REDIS_PASSWORD
    value: ${redis.password}
  - key: POSTGRES_HOST
    value: ${postgres.host}
  - key: POSTGRES_PORT
    value: ${postgres.port}
  - key: POSTGRES_USER
    value: ${postgres.user}
  - key: POSTGRES_PASSWORD
    value: ${postgres.password}
  - key: POSTGRES_DB
    value: ${postgres.database}
  - key: FIRECRAWL_API_KEY
    scope: RUN_TIME
    type: SECRET
    value: ${firecrawl.api_key}
  - key: FIRECRAWL_API_URL
    value: "https://api.firecrawl.dev/v0/scrape"
  - key: GUPY_BUILD_ID
    scope: RUN_TIME
    type: SECRET
    value: ${gupy.build_id}

- name: worker
  github:
    branch: playgroud
    repo: jgabrielsantosc/scraper-jobboard
  build_command: npm run build:api
  run_command: npm run start:worker
  instance_count: 1
  instance_size_slug: basic-xxs
  envs:
  - key: NODE_ENV
    value: production
  - key: REDIS_HOST
    value: ${redis.host}
  - key: REDIS_PORT
    value: ${redis.port}
  - key: REDIS_PASSWORD
    value: ${redis.password}
  - key: POSTGRES_HOST
    value: ${postgres.host}
  - key: POSTGRES_PORT
    value: ${postgres.port}
  - key: POSTGRES_USER
    value: ${postgres.user}
  - key: POSTGRES_PASSWORD
    value: ${postgres.password}
  - key: POSTGRES_DB
    value: ${postgres.database}
  - key: FIRECRAWL_API_KEY
    scope: RUN_TIME
    type: SECRET
    value: ${firecrawl.api_key}
  - key: FIRECRAWL_API_URL
    value: "https://api.firecrawl.dev/v0/scrape"
  - key: GUPY_BUILD_ID
    scope: RUN_TIME
    type: SECRET
    value: ${gupy.build_id}

databases:
- name: redis
  engine: REDIS
  version: "7"
  production: true
  cluster: false
  
- name: postgres
  engine: PG
  version: "15"
  production: true
  cluster: false 